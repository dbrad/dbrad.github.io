function C(t,e,n){return n=t.createShader(n),t.shaderSource(n,e),t.compileShader(n),n}function D(t,e,n){var r=t.createProgram();return e=C(t,e,35633),n=C(t,n,35632),t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r),r}function F(t,e,n,r){var i=t.createBuffer();return t.bindBuffer(e,i),t.bufferData(e,n,r),i}window.TCShd=C,window.TCPrg=D,window.TCBuf=F,window.TCTex=function(t,e,n,r){var i=t.createTexture();return t.bindTexture(3553,i),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),t.texParameteri(3553,10240,9728),t.texParameteri(3553,10241,9728),t.texImage2D(3553,0,6408,6408,5121,e),t.bindTexture(3553,null),i.width=n,i.height=r,i},window.TC=function(t){var e=t.getContext("webgl"),n=t.width,r=t.height,i=D(e,"precision lowp float;\nattribute vec2 a, b;\nattribute vec4 c;\nvarying vec2 d;\nvarying vec4 e;\nuniform mat4 m;\nuniform vec2 r;\nvoid main(){\ngl_Position=m*vec4(a,1.0,1.0);\nd=b;\ne=c;\n}","precision lowp float;\nvarying vec2 d;\nvarying vec4 e;\nuniform sampler2D f;\nvoid main(){\ngl_FragColor=texture2D(f,d)*e;\n}"),o=e.bufferSubData.bind(e),a=e.drawElements.bind(e),s=e.bindTexture.bind(e),u=e.clear.bind(e),l=e.clearColor.bind(e),d=new ArrayBuffer(873760),c=new Float32Array(d),h=new Uint32Array(d),p=new Uint16Array(131064),g=F(e,34963,p.byteLength,35044),m=F(e,34962,d.byteLength,35048),f=0,w=new Float32Array([1,0,0,1,0,0]),S=new Float32Array(100),x=0,b=Math.cos,A=Math.sin,T=null,y=null;for(e.blendFunc(770,771),e.enable(3042),e.useProgram(i),e.bindBuffer(34963,g),g=indexB=0;65532>g;g+=6,indexB+=4)p[g+0]=indexB,p[g+1]=indexB+1,p[g+2]=indexB+2,p[g+3]=indexB+0,p[g+4]=indexB+3,p[g+5]=indexB+1;return o(34963,0,p),e.bindBuffer(34962,m),p=e.getAttribLocation(i,"a"),m=e.getAttribLocation(i,"b"),g=e.getAttribLocation(i,"c"),e.enableVertexAttribArray(p),e.vertexAttribPointer(p,2,5126,0,20,0),e.enableVertexAttribArray(m),e.vertexAttribPointer(m,2,5126,0,20,8),e.enableVertexAttribArray(g),e.vertexAttribPointer(g,4,5121,1,20,16),e.uniformMatrix4fv(e.getUniformLocation(i,"m"),0,new Float32Array([2/n,0,0,0,0,-2/r,0,0,0,0,1,1,-1,1,0,0])),e.activeTexture(33984),y={g:e,c:t,col:4294967295,bkg:function(t,e,n){l(t,e,n,1)},cls:function(){u(16384)},trans:function(t,e){w[4]=w[0]*t+w[2]*e+w[4],w[5]=w[1]*t+w[3]*e+w[5]},scale:function(t,e){w[0]*=t,w[1]*=t,w[2]*=e,w[3]*=e},rot:function(t){var e=w[0],n=w[1],r=w[2],i=w[3],o=A(t);t=b(t),w[0]=e*t+r*o,w[1]=n*t+i*o,w[2]=e*-o+r*t,w[3]=n*-o+i*t},push:function(){S[x+0]=w[0],S[x+1]=w[1],S[x+2]=w[2],S[x+3]=w[3],S[x+4]=w[4],S[x+5]=w[5],x+=6},pop:function(){x-=6,w[0]=S[x+0],w[1]=S[x+1],w[2]=S[x+2],w[3]=S[x+3],w[4]=S[x+4],w[5]=S[x+5]},img:function(t,e,n,r,i,u,l,p,g){var m=e+r,S=n+i;i=n+i,r=e+r;var x=w[0],b=w[1],A=w[2],_=w[3],C=w[4],I=w[5],v=y.col;(t!=T||10922<=f+1)&&(o(34962,0,d),a(4,6*f,5123,0),f=0,T!=t&&s(3553,T=t)),t=20*f,c[t++]=e*x+n*A+C,c[t++]=e*b+n*_+I,c[t++]=u,c[t++]=l,h[t++]=v,c[t++]=m*x+S*A+C,c[t++]=m*b+S*_+I,c[t++]=p,c[t++]=g,h[t++]=v,c[t++]=e*x+i*A+C,c[t++]=e*b+i*_+I,c[t++]=u,c[t++]=g,h[t++]=v,c[t++]=r*x+n*A+C,c[t++]=r*b+n*_+I,c[t++]=p,c[t++]=l,h[t++]=v,10922<=++f&&(o(34962,0,d),a(4,6*f,5123,0),f=0)},flush:function(){0!=f&&(o(34962,0,c.subarray(0,20*f)),a(4,6*f,5123,0),f=0)}}};class StateMachine{constructor(){this._stateDictionary={},this._stateStack=[]}register(t){this._stateDictionary[t.name]=t}get current(){return this._stateStack[this._stateStack.length-1]}push(t){this.current&&this.current.transitionOut&&this.current.transitionOut(),this._stateStack.push(this._stateDictionary[t]),this.current&&this.current.transitionIn&&this.current.transitionIn()}pop(){this.current&&this.current.transitionOut&&this.current.transitionOut();var t=this._stateStack.pop();return this.current&&this.current.transitionIn&&this.current.transitionIn(),t}}var Game,Assets,Input,Scenes;!function(t){let e,n,r;function i(e){let o=e-r;r=e,function(t,e){let r=n.current;r&&r.update(t,e)}(e,o),function(e,r){let i=n.current;t._gl.cls(),i&&i.render(t._gl,e,r),t._gl.flush()}(e,o),requestAnimationFrame(i)}t.addScene=function(t){n.register(t)},t.pushScene=function(t){n.push(t)},t.popScene=function(){n.pop()},t.init=function(r){e=r,t._gl=TC(e),n=new StateMachine},t.start=function(){r=performance.now(),t._gl.bkg(25,25,25),requestAnimationFrame(i)}}(Game||(Game={}));class Sprite{constructor(t){this.animations={},this.animationQueue=[],this.animations.DEFAULT=t,this.play("DEFAULT")}get currentAnimation(){return this.animationQueue[0]}get currentFrame(){return this.currentAnimation.currentFrame}addAnimation(t,e){this.animations[t]=e}play(t,e=!1){return this.animationQueue.length=0,this.animations[t].loop=e,this.animationQueue.push(this.animations[t]),this}then(t){return this.animationQueue.push(this.animations[t]),this}next(){this.animationQueue.shift(),0===this.animationQueue.length&&this.stop()}stop(){this.animationQueue.length=0,this.animationQueue.push(this.animations.DEFAULT)}update(t,e){this.currentAnimation.done&&this.next(),this.currentAnimation.update(e)}}function drawText(t,e,n,r,i=0){let o=e.split(" "),a=n,s=0;for(let e of o){0!=i&&s+6*e.length>i&&(r+=6,s=0);for(let i of e.split("")){let e=i.toLowerCase(),o=Assets.TextureStore[e];n=a+s,t.push(),t.trans(n,r),t.img(o.atlas,0,0,o.w,o.h,o.u0,o.v0,o.u1,o.v1),t.pop(),s+=6}s+=6}}function drawSprite(t,e,n,r){let i=e.w,o=~~(e.w/2),a=e.h,s=~~(e.h/2);t.push(),t.trans(n*i+o,r*a+s),t.img(e.atlas,-o,-s,i,a,e.u0,e.v0,e.u1,e.v1),t.pop()}function drawDialog(t,e,n,r,i){let o,a=e+r-1,s=n+i-1;for(let r=e;r<=a;r++)for(let i=n;i<=s;i++)drawSprite(t,o=r===e?i===n?Assets.TextureStore.dialog_tl:i===s?Assets.TextureStore.dialog_bl:Assets.TextureStore.dialog_ml:r===a?i===n?Assets.TextureStore.dialog_tr:i===s?Assets.TextureStore.dialog_br:Assets.TextureStore.dialog_mr:i===n?Assets.TextureStore.dialog_t:i===s?Assets.TextureStore.dialog_b:Assets.TextureStore.dialog_m,r,i)}!function(t){t.Animation=class{constructor(t){this._duration=-1,this.progress=0,this.loop=!1,this.done=!1,this.frames=t}get currentFrame(){if(0===this.duration)return this.frames[0];{let t=0;for(let e in this.frames)if(t+=this.frames[e].duration,this.progress<=t)return this.frames[e];return this.frames[this.frames.length-1]}}get duration(){if(-1===this._duration){this._duration=0;for(let t of this.frames)this._duration+=t.duration}return this._duration}update(t){if(this.done=!1,0===this.duration)return this.frames[0];this.progress+=t,this.progress>this.duration&&(this.loop?this.progress=0:(this.progress=0,this.done=!0))}}}(Sprite||(Sprite={})),function(t){t.TextureAtlasStore={},t.TextureStore={},t.load=function(e,n){let r=0,i=()=>{--r<=0&&n()};for(let n in e){let o=new Image;o.onload=function(n,r,i){let o=n,a=e[o];return()=>{let e=TCTex(Game._gl.g,r,r.width,r.height),n=a.sprites;t.TextureAtlasStore[o]=e;for(let i=0;i<n.length;i++)for(let o=0;o<n[i].length;o++)t.TextureStore[n[i][o]]={atlas:e,w:a.sWidth,h:a.sHeight,u0:o*a.sWidth/r.width,v0:i*a.sHeight/r.height,u1:(o*a.sWidth+a.sWidth)/r.width,v1:(i*a.sHeight+a.sHeight)/r.height};i()}}(n,o,i),r++,o.src=e[n].loc}}}(Assets||(Assets={})),function(t){t.MainMenu={name:"MainMenu",transitionIn(){Input.bindControl("ACTION",()=>{Game.pushScene("Main")})},transitionOut(){Input.unbindControl("ACTION")},update(t,e){},render(t,e,n){t.col=4278190335,drawDialog(t,0,0,40,22),t.col=4294967295,drawText(t,"Main Menu Yall",8,8),drawText(t,"Main Menu Yall",16,16),drawText(t,"Main Menu Yall",24,24)}}}(Scenes||(Scenes={})),function(t){t.Controls={};let e=[],n=[],r=[];for(let t=0;t<256;t++)r[t]=!0;function i(t){let i=t.which;r[i]&&e[i]&&e[i].keyDown(),r[i]=!1,n[i]=!0}function o(t){let i=t.which;e[i]&&e[i].keyUp(),n[i]=!1,r[i]=!0}window.onkeydown=i,window.onkeyup=o,t.keyDown=i,t.keyUp=o,t.bindKey=function(t,n,r=(()=>{})){e[t]={keyDown:n,keyUp:r}},t.unbindKey=function(t){delete e[t]},t.bindControl=function(n,r,i=(()=>{})){for(let o of t.Controls[n])e[o]={keyDown:r,keyUp:i}},t.unbindControl=function(n){for(let r of t.Controls[n])delete e[r]}}(Input||(Input={})),function(t){let e=[0,0];t.Main={name:"Main",transitionIn(){Input.bindControl("RIGHT",()=>{e[0]++}),Input.bindControl("LEFT",()=>{e[0]--}),Input.bindControl("DOWN",()=>{e[1]++}),Input.bindControl("UP",()=>{e[1]--}),Input.bindControl("ACTION",()=>{Game.popScene()})},transitionOut(){Input.unbindControl("RIGHT"),Input.unbindControl("LEFT"),Input.unbindControl("DOWN"),Input.unbindControl("UP"),Input.unbindControl("ACTION")},update(t,e){SpriteStore[0].update(t,e),SpriteStore[1].update(t,e)},render(t,n,r){let i;for(let e=0;e<40;e++)for(let n=0;n<18;n++)0===e||39===e||0===n||17===n?(t.col=4278387459,i=Assets.TextureStore.brick):(t.col=4279176975,i=Assets.TextureStore.brick),drawSprite(t,i,e,n);t.col=4294967295,drawSprite(t,SpriteStore[0].currentFrame.texture,5,9),drawSprite(t,SpriteStore[1].currentFrame.texture,e[0],e[1]),drawSprite(t,SpriteStore[0].currentFrame.texture,34,9),t.col=4278190335,drawDialog(t,0,18,40,4),t.col=4294967295,drawText(t,"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec eu condimentum purus, eu pharetra arcu. Mauris imperdiet consectetur odio sed volutpat.",6,150,308)}}}(Scenes||(Scenes={}));let SpriteStore=[];window.onload=(()=>{function t(){let t=Game._gl.c,e=0|Math.min(window.innerWidth/t.width,window.innerHeight/t.height);e=e<=0?1:e;let n=[t.width*e,t.height*e],r=[(window.innerWidth-n[0])/2,(window.innerHeight-n[1])/2],i="translate("+~~r[0]+"px, "+~~r[1]+"px) scale("+~~e+")",o=document.getElementById("stage");o.style.transform=i,o.style.webkitTransform=i}Game.init(document.getElementById("canvas")),Input.Controls.UP=[38,87],Input.Controls.DOWN=[40,83],Input.Controls.LEFT=[37,65],Input.Controls.RIGHT=[39,68],Input.Controls.ACTION=[13,32],Game.addScene(Scenes.MainMenu),Game.addScene(Scenes.Main),Assets.load({alpha:{loc:"res/alpha.png",sWidth:5,sHeight:5,sprites:[["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],["1","2","3","4","5","6","7","8","9","0",".","!","?","#","(",")","-","^","+","=","/","\\",":",",","'",'"']]},tiles:{loc:"res/test.png",sWidth:8,sHeight:8,sprites:[["brick","guy_stand","guy_01","guy_02"],["dialog_tl","dialog_t","dialog_tr","blank03"],["dialog_ml","dialog_m","dialog_mr","blank04"],["dialog_bl","dialog_b","dialog_br","blank05"]]}},()=>{window.onresize=t,t(),Game.start();let e=new Sprite(new Sprite.Animation([{texture:Assets.TextureStore.guy_stand,duration:250}]));e.addAnimation("walk",new Sprite.Animation([{texture:Assets.TextureStore.guy_01,duration:250},{texture:Assets.TextureStore.guy_02,duration:250}])),SpriteStore[0]=e,e.play("walk",!0);let n=new Sprite(new Sprite.Animation([{texture:Assets.TextureStore.guy_stand,duration:250}]));n.addAnimation("walk",new Sprite.Animation([{texture:Assets.TextureStore.guy_stand,duration:250},{texture:Assets.TextureStore.guy_01,duration:250},{texture:Assets.TextureStore.guy_stand,duration:250},{texture:Assets.TextureStore.guy_02,duration:250}])),SpriteStore[1]=n,n.play("walk",!0),Game.pushScene("MainMenu")})});